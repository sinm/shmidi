#!/usr/bin/env ruby

if ENV['PROFILE'] && ENV['PROFILE'] != 0
  begin
    require 'perftools'
    PerfTools::CpuProfiler.start 'test.profile'
    at_exit { PerfTools::CpuProfiler.stop }
  rescue LoadError
    $stderr.puts "WARN: No profiler found."
  end
end

trap('INT') do
  exit!(0)
end

require 'shmidi'

if ARGV.include?('--list')
  Shmidi::Processor.print_device_list
  exit(0)
end

@processor = Shmidi::Processor.new(ARGV[0..3].map{|v|v.to_i})
@processor.random_on_off(15, 1)
@processor.blink(15, 12, 10)
@processor.notes_off(15)


@processor.join

